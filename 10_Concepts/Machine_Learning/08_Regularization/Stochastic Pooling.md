
## âœ… 1. ê°œìš”: Stochastic Poolingì´ë€?

**Stochastic Pooling**ì€ 2013ë…„ **Zeiler et al.** ì˜ ë…¼ë¬¸

> _â€œStochastic Pooling for Regularization of Deep Convolutional Neural Networksâ€_  
> ì—ì„œ ì œì•ˆëœ ê¸°ë²•ì…ë‹ˆë‹¤.

> ğŸ” í•µì‹¬ ì•„ì´ë””ì–´:  
> í’€ë§ ìœˆë„ìš° ì•ˆì—ì„œ ê°€ì¥ í° ê°’ì´ë‚˜ í‰ê· ì„ ì„ íƒí•˜ëŠ” ëŒ€ì‹ , **ê°’ì˜ í¬ê¸°ë¥¼ í™•ë¥ ì²˜ëŸ¼ ê°„ì£¼í•˜ê³  ê·¸ì— ë”°ë¼ ë¬´ì‘ìœ„ë¡œ í•˜ë‚˜ì˜ ê°’ì„ ìƒ˜í”Œë§**í•©ë‹ˆë‹¤.

---

## âœ… 2. ì™œ í•„ìš”í–ˆëŠ”ê°€?

### ê¸°ì¡´ í’€ë§ ë°©ì‹ì˜ í•œê³„

|ë°©ì‹|íŠ¹ì§•|í•œê³„|
|---|---|---|
|**Max Pooling**|ê°€ì¥ í° ê°’ ì„ íƒ|í•™ìŠµì— ê°•í•œ ì˜í–¥ë ¥ (ê·¹ë‹¨ì ), gradient sparsity|
|**Average Pooling**|í‰ê·  ì„ íƒ|ì •ë³´ í¬ì„, ì¤‘ìš”í•œ íŠ¹ì§•ì´ ì‚¬ë¼ì§ˆ ìˆ˜ ìˆìŒ|

### Stochastic Poolingì˜ í•´ê²°ì±…

- ì¤‘ìš”í•œ ê°’ì´ ë½‘í í™•ë¥ ì€ ë†’ì´ë˜,
    
- **ë¬´ì¡°ê±´ í° ê°’ë§Œ ì“°ì§€ ì•Šê³  ë‹¤ë¥¸ ê°’ë„ ì„ íƒë  ìˆ˜ ìˆë„ë¡ í™•ë¥  ë¶„í¬ ê¸°ë°˜ ìƒ˜í”Œë§**
    

---

## âœ… 3. ìˆ˜í•™ì  ì›ë¦¬

í’€ë§ ìœˆë„ìš° ì•ˆì˜ ê°’ë“¤ì„ ë‹¤ìŒê³¼ ê°™ì´ ë‘ì:

$$
\text{pooling region } R = \{a_1, a_2, \dots, a_n\},\quad a_i > 0
$$

ì´ë•Œ ê° ê°’ $a_i$ì— ëŒ€í•´ ë‹¤ìŒê³¼ ê°™ì€ í™•ë¥ ë¡œ ì„ íƒë  ìˆ˜ ìˆë„ë¡ ì •ì˜:

$$
p_i = \frac{a_i}{\sum_{j=1}^n a_j}
$$

ì¦‰, $a_i$ì˜ ë¹„ìœ¨ë§Œí¼ ì„ íƒë  í™•ë¥ ì„ ê°€ì§ â†’ **Multinomial sampling**

ê·¸ í›„ ì´ í™•ë¥  ë¶„í¬ë¥¼ ê¸°ë°˜ìœ¼ë¡œ **í•˜ë‚˜ì˜ ì¸ë±ìŠ¤ë¥¼ ë¬´ì‘ìœ„ë¡œ ìƒ˜í”Œë§**í•˜ì—¬ í•´ë‹¹ $a_i$ ê°’ì„ ì„ íƒí•¨.

---

## âœ… 4. ì˜ˆì‹œ (ì§ê´€)

í’€ë§ ìœˆë„ìš°ê°€ ë‹¤ìŒê³¼ ê°™ë‹¤ê³  ê°€ì •:

```
[1, 2]
[3, 4]
```

ì´ ë•Œ ê° ê°’ì˜ í™•ë¥ ì€:

$$
\begin{align*} p_1 &= \frac{1}{10}, \quad p_2 = \frac{2}{10} \\ p_3 &= \frac{3}{10}, \quad p_4 = \frac{4}{10} \end{align*}
$$

ì¦‰, 4ê°€ ì„ íƒë  í™•ë¥ ì´ ê°€ì¥ ë†’ì§€ë§Œ, **1~3ë„ ì„ íƒë  ìˆ˜ ìˆìŒ**.

---

## âœ… 5. Forward ë° Backward

- **Forward pass**: ê° í’€ë§ ìœˆë„ìš°ë§ˆë‹¤ í™•ë¥  ë¶„í¬ë¥¼ ë§Œë“¤ê³  í•˜ë‚˜ì˜ ê°’ì„ ë¬´ì‘ìœ„ ìƒ˜í”Œë§.
    
- **Backward pass**: ì„ íƒëœ ê°’ì˜ ìœ„ì¹˜ì—ë§Œ gradientë¥¼ ì „ë‹¬.
    

ì´ ê³¼ì •ì€ Max Poolingê³¼ ìœ ì‚¬í•˜ì§€ë§Œ, ì„ íƒ ìœ„ì¹˜ê°€ **í™•ë¥ ì ìœ¼ë¡œ ë³€ë™**ë¨.

---

## âœ… 6. ì¥ì 

|ì¥ì |ì„¤ëª…|
|---|---|
|âœ… Regularization íš¨ê³¼|Dropoutì²˜ëŸ¼ **ë¬´ì‘ìœ„ì„± ë„ì…** â†’ ê³¼ì í•© ë°©ì§€|
|âœ… ì •ë³´ ì†ì‹¤ ì™„í™”|Averageë³´ë‹¤ ì •ë³´ ìœ ì§€, Maxë³´ë‹¤ ë‹¤ì–‘ì„± ìˆìŒ|
|âœ… gradient sparsity ì™„í™”|Maxì™€ ë‹¬ë¦¬ ë‹¤ì–‘í•œ ìœ„ì¹˜ì—ì„œ gradientê°€ ë°œìƒ ê°€ëŠ¥|

---

## âœ… 7. ë‹¨ì 

|ë‹¨ì |ì„¤ëª…|
|---|---|
|âŒ ì¶”ë¡  ì‹œ ì¼ê´€ì„± ë¶€ì¡±|ë§¤ë²ˆ ë¬´ì‘ìœ„ ê²°ê³¼ ë°œìƒ â†’ í…ŒìŠ¤íŠ¸ì—ì„œ ê³ ì •ëœ ë°©ì‹ í•„ìš”|
|âŒ ê³„ì‚°ëŸ‰ ì¦ê°€|í™•ë¥  ê³„ì‚° ë° ìƒ˜í”Œë§ í•„ìš”|
|âŒ ì•ˆì •ì„± â†“|í•™ìŠµ ìˆ˜ë ´ ì†ë„ê°€ ëŠë¦´ ìˆ˜ ìˆìŒ|

> ì¶”ë¡ (test)ì—ì„œëŠ” í™•ë¥ ì  ì„ íƒ ëŒ€ì‹  **ê¸°ëŒ“ê°’(expectation pooling)**ì„ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ë„ ìˆìŒ:

$$
\sum_{i=1}^n p_i a_i = \sum_{i=1}^n \left( \frac{a_i^2}{\sum_j a_j} \right)
$$

---

## âœ… 8. êµ¬í˜„ ì˜ˆì‹œ (PyTorch)

PyTorchì—ì„œëŠ” ê¸°ë³¸ ì œê³µë˜ì§€ ì•Šì§€ë§Œ ë‹¤ìŒê³¼ ê°™ì´ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```python
import torch
import torch.nn.functional as F

def stochastic_pool2d(x, kernel_size):
    B, C, H, W = x.shape
    kH, kW = kernel_size

    # Unfold â†’ [B, C * kH * kW, L] where L = num of patches
    x_unf = F.unfold(x, kernel_size)
    x_unf = x_unf.view(B, C, kH * kW, -1)  # [B, C, kH*kW, L]

    # Compute probabilities
    probs = x_unf / (x_unf.sum(dim=2, keepdim=True) + 1e-8)

    # Sample indices
    sampled_idx = torch.multinomial(probs.permute(0, 1, 3, 2).reshape(-1, kH * kW), 1).squeeze(-1)

    # Gather sampled values
    idx_offset = torch.arange(0, sampled_idx.shape[0]) * kH * kW
    flat_x = x_unf.permute(0, 1, 3, 2).reshape(-1, kH * kW)
    out = flat_x[torch.arange(len(sampled_idx)), sampled_idx]

    # Reshape to [B, C, H//kH, W//kW]
    out = out.view(B, C, H // kH, W // kW)
    return out
```

---

## âœ… 9. ë…¼ë¬¸ ì„±ëŠ¥ ë° ì‚¬ë¡€

- **Zeiler et al. (2013)**:
    
    - MNIST, CIFAR-10, SVHNì—ì„œ ì‹¤í—˜
        
    - Max Poolingë³´ë‹¤ ë” ë‚˜ì€ ì¼ë°˜í™” ì„±ëŠ¥
        
- **CNNì—ì„œ Dropout ëŒ€ì•ˆ**ìœ¼ë¡œ ì—°êµ¬ë˜ì—ˆìœ¼ë‚˜,
    
    - ì¶”ë¡ ì˜ ë¹„ê²°ì •ì„± ë•Œë¬¸ì— ë„ë¦¬ ì±„íƒë˜ì§„ ì•ŠìŒ
        

---

## âœ… 10. ê²°ë¡  ìš”ì•½

|í•­ëª©|ë‚´ìš©|
|---|---|
|ğŸ¯ ê°œë…|í™•ë¥  ê¸°ë°˜ìœ¼ë¡œ pooling region ë‚´ ê°’ì„ ìƒ˜í”Œë§|
|ğŸ§  ì§ê´€|ê°’ì´ í´ìˆ˜ë¡ ì„ íƒë  í™•ë¥ ì´ ë†’ìŒ|
|ğŸ“ˆ ì¥ì |ì •ë³´ ì†ì‹¤ ë°©ì§€ + ì •ê·œí™” íš¨ê³¼|
|âš ï¸ ë‹¨ì |ë¬´ì‘ìœ„ì„±ìœ¼ë¡œ ì¸í•´ ì•ˆì •ì„± ë° ì†ë„ ì´ìŠˆ|
|ğŸ”¬ í™œìš©|CNNì˜ ì •ê·œí™” ëŒ€ì•ˆ, í•™ìŠµ ë‹¤ë³€í™” ì „ëµ|

---

í•„ìš”í•˜ì‹œë©´ `Stochastic Pooling vs Dropout vs DropConnect` ë¹„êµë‚˜, ìµœê·¼ ë…¼ë¬¸ì—ì„œ ì‚¬ìš©ëœ ë³€í˜• ì‚¬ë¡€ë“¤ë„ ì´ì–´ì„œ ì„¤ëª…ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.